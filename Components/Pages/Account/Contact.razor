@page "/contact"
@using System.ComponentModel.DataAnnotations
@using webshop.Services
@inject IJSRuntime JS
@inject EmailService EmailService
@rendermode InteractiveServer

<div class="container py-5">
    <div class="row g-5">

        @* BAL OLDAL: ELÉRHETŐSÉGEK ÉS TÉRKÉP *@
        <div class="col-lg-5">
            <h2 class="fw-bold mb-4">Kapcsolatfelvétel</h2>
            <p class="text-muted mb-5">Látogasson el hozzánk személyesen, vagy keressen minket bizalommal az alábbi elérhetőségek bármelyikén.</p>

            <div class="d-flex mb-4">
                <div class="bg-primary-subtle text-primary rounded-3 p-3 me-3">
                    <i class="bi bi-geo-alt-fill fs-4"></i>
                </div>
                <div>
                    <h6 class="fw-bold mb-1">Címünk</h6>
                    <p class="text-muted mb-0">1051 Budapest, Kossuth Lajos tér 1.</p>
                </div>
            </div>

            <div class="d-flex mb-4">
                <div class="bg-primary-subtle text-primary rounded-3 p-3 me-3">
                    <i class="bi bi-telephone-fill fs-4"></i>
                </div>
                <div>
                    <h6 class="fw-bold mb-1">Telefonszám</h6>
                    <p class="text-muted mb-0">+36 30 123 4567</p>
                </div>
            </div>

            <div class="d-flex mb-5">
                <div class="bg-primary-subtle text-primary rounded-3 p-3 me-3">
                    <i class="bi bi-envelope-at-fill fs-4"></i>
                </div>
                <div>
                    <h6 class="fw-bold mb-1">E-mail</h6>
                    <p class="text-muted mb-0">info@modernwebshop.hu</p>
                </div>
            </div>

            @* GOOGLE TÉRKÉP *@
            <div class="rounded-4 overflow-hidden shadow-sm border" style="height: 350px;">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2695.122822998379!2d19.04597377691851!3d47.50692229553759!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4741dc0df546943d%3A0x3d4928212128493d!2sBudapest%2C%20Kossuth%20Lajos%20t%C3%A9r%201%2C%201051!5e0!3m2!1shu!2shu!4v1700000000000!5m2!1shu!2shu"
                        width="100%"
                        height="100%"
                        style="border:0;"
                        allowfullscreen=""
                        loading="lazy"
                        referrerpolicy="no-referrer-when-downgrade">
                </iframe>
            </div>
        </div>

        @* JOBB OLDAL: ÜZENETKÜLDŐ FORM *@
        <div class="col-lg-7">
            <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
                <div class="card-body p-4 p-md-5">
                    <h3 class="fw-bold mb-4">Üzenet küldése</h3>
                    <EditForm Model="contactModel" OnValidSubmit="HandleSubmit">
                        <DataAnnotationsValidator />

                        <div class="row g-3">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold small">Teljes név</label>
                                <InputText @bind-Value="contactModel.Name" class="form-control form-control-lg rounded-3 fs-6" placeholder="Példa János" />
                                <ValidationMessage For="() => contactModel.Name" class="text-danger small" />
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold small">E-mail cím</label>
                                <InputText @bind-Value="contactModel.Email" class="form-control form-control-lg rounded-3 fs-6" placeholder="janos@pelda.hu" />
                                <ValidationMessage For="() => contactModel.Email" class="text-danger small" />
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-bold small">Üzenet tárgya</label>
                            <InputText @bind-Value="contactModel.Subject" class="form-control form-control-lg rounded-3 fs-6" placeholder="Mivel kapcsolatban ír?" />
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-bold small">Üzenet szövege</label>
                            <InputTextArea @bind-Value="contactModel.Message" class="form-control form-control-lg rounded-3 fs-6" rows="5" placeholder="Írja le részletesen kérdését..." />
                            <ValidationMessage For="() => contactModel.Message" class="text-danger small" />
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg w-100 rounded-pill fw-bold shadow-sm py-3" disabled="@isSubmitting">
                            @if (isSubmitting)
                            {
                                <span class="spinner-border spinner-border-sm me-2"></span>
                                <span>Küldés folyamatban...</span>
                            }
                            else
                            {
                                <i class="bi bi-send-fill me-2"></i>
                                <span>Üzenet elküldése</span>
                            }
                        </button>
                    </EditForm>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private ContactForm contactModel = new();
    private bool isSubmitting = false;

    private async Task HandleSubmit()
    {
        isSubmitting = true;

        // Email küldése az adminnak
        await EmailService.SendContactEmailAsync(
            contactModel.Name,
            contactModel.Email,
            string.IsNullOrEmpty(contactModel.Subject) ? "Nincs tárgy" : contactModel.Subject,
            contactModel.Message);

        await JS.InvokeVoidAsync("alert", "Köszönjük az üzenetet! Hamarosan válaszolunk.");

        contactModel = new ContactForm(); // Form ürítése
        isSubmitting = false;
    }

    public class ContactForm
    {
        [Required(ErrorMessage = "A név kitöltése kötelező.")]
        public string Name { get; set; } = "";

        [Required(ErrorMessage = "Az e-mail cím kitöltése kötelező.")]
        [EmailAddress(ErrorMessage = "Érvénytelen e-mail formátum.")]
        public string Email { get; set; } = "";

		[Required(ErrorMessage = "Az üzenet tárgya nem lehet üres.")]
        public string Subject { get; set; } = "";

        [Required(ErrorMessage = "Az üzenet szövege nem lehet üres.")]
        [MinLength(10, ErrorMessage = "Kérjük, írjon bővebben (min. 10 karakter).")]
        public string Message { get; set; } = "";
    }
}